// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// User profiles table
model Profile {
  id          String   @id @default(cuid())
  email       String?  @unique
  firstName   String?  @map("first_name")
  lastName    String?  @map("last_name")
  fullName    String?  @map("full_name")
  phone       String?
  role        String   @default("passenger") // passenger, driver, admin
  avatarUrl   String?  @map("avatar_url")
  wilaya      String?
  commune     String?
  address     String?
  dateOfBirth String?  @map("date_of_birth")
  isVerified  Boolean  @default(false) @map("is_verified")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  bookingsAsPassenger Booking[] @relation("PassengerBookings")
  bookingsAsDriver    Booking[] @relation("DriverBookings")
  trips               Trip[]
  vehicles            Vehicle[]
  notifications       Notification[]
  adminLogs           AdminLog[]
  systemSettings      SystemSetting[]

  @@map("profiles")
}

// Bookings table
model Booking {
  id                    Int      @id @default(autoincrement())
  createdAt             DateTime @default(now()) @map("created_at")
  pickupLocation        String   @map("pickup_location")
  destinationLocation   String   @map("destination_location")
  passengerId           String?  @map("passenger_id")
  driverId              String?  @map("driver_id")
  status                String   @default("pending") // pending, confirmed, completed, cancelled
  seatsBooked           Int      @default(1) @map("seats_booked")
  totalAmount           Float?   @map("total_amount")
  paymentMethod         String?  @default("cod") @map("payment_method") // cod, baridimob
  tripId                String?  @map("trip_id")
  notes                 String?
  pickupTime            String?  @map("pickup_time")
  specialRequests       String?  @map("special_requests")

  // Relations
  passenger Profile? @relation("PassengerBookings", fields: [passengerId], references: [id])
  driver    Profile? @relation("DriverBookings", fields: [driverId], references: [id])
  trip      Trip?    @relation(fields: [tripId], references: [id])

  @@map("bookings")
}

// Trips table
model Trip {
  id              String   @id @default(cuid())
  driverId        String   @map("driver_id")
  vehicleId       String?  @map("vehicle_id")
  fromWilayaId    Int      @map("from_wilaya_id")
  toWilayaId      Int      @map("to_wilaya_id")
  departureDate   String   @map("departure_date")
  departureTime   String   @map("departure_time")
  pricePerSeat    Float    @map("price_per_seat")
  totalSeats      Int      @map("total_seats")
  availableSeats  Int      @map("available_seats")
  description     String?
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  driver   Profile   @relation(fields: [driverId], references: [id])
  vehicle  Vehicle?  @relation(fields: [vehicleId], references: [id])
  bookings Booking[]

  @@map("trips")
}

// Vehicles table
model Vehicle {
  id           String   @id @default(cuid())
  driverId     String   @map("driver_id")
  make         String
  model        String
  year         Int
  color        String
  licensePlate String   @map("license_plate")
  seats        Int
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  driver Profile @relation(fields: [driverId], references: [id])
  trips  Trip[]

  @@map("vehicles")
}

// Wilayas table (Algerian states)
model Wilaya {
  id     Int    @id
  code   Int    @unique
  name   String
  nameAr String @map("name_ar")

  @@map("wilayas")
}

// System settings table
model SystemSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   // JSON string
  description String?
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")
  updatedBy   String?  @map("updated_by")

  // Relations
  updatedByProfile Profile? @relation(fields: [updatedBy], references: [id])

  @@map("system_settings")
}

// Admin logs table
model AdminLog {
  id         String   @id @default(cuid())
  adminId    String   @map("admin_id")
  action     String
  targetType String?  @map("target_type")
  targetId   String?  @map("target_id")
  details    String?  // JSON string
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  admin Profile @relation(fields: [adminId], references: [id])

  @@map("admin_logs")
}

// Notifications table
model Notification {
  id          String    @id @default(cuid())
  userId      String    @map("user_id")
  title       String
  message     String
  type        String    @default("info") // info, success, warning, error, booking, trip, system, payment
  category    String    @default("system") // booking, trip, system, payment
  priority    String    @default("medium") // low, medium, high, critical
  status      String    @default("pending") // pending, sent, failed, cancelled
  isRead      Boolean   @default(false) @map("is_read")
  relatedId   String?   @map("related_id")
  relatedType String?   @map("related_type")
  actionUrl   String?   @map("action_url")
  imageUrl    String?   @map("image_url")
  scheduledFor DateTime? @map("scheduled_for")
  expiresAt   DateTime? @map("expires_at")
  metadata    String?   // JSON string
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  user Profile @relation(fields: [userId], references: [id])

  @@map("notifications")
}