# دليل إدارة الركاب للمدير

## نظرة عامة
تم إضافة ميزة إدارة الركاب في لوحة تحكم المدير، حيث يمكن للمديرين إيقاف وتفعيل حسابات الركاب.

## الميزات المضافة

### 1. عرض قائمة الركاب
- عرض جميع حسابات الركاب في جدول منظم
- عرض معلومات الراكب: الاسم، البريد الإلكتروني، الهاتف، الحالة، تاريخ الإنشاء
- عرض صورة الراكب (أفاتار)

### 2. إدارة حالة الحساب
- **إيقاف الحساب**: منع الراكب من الحجز والوصول للنظام
- **تفعيل الحساب**: إعادة تفعيل الحساب الموقوف
- تحديث فوري للحالة في الواجهة

### 3. واجهة المستخدم
- جدول منظم لعرض الركاب
- أزرار واضحة للإجراءات (إيقاف/تفعيل)
- مؤشرات بصرية للحالة (نشط/موقوف)
- رسائل تأكيد عند تنفيذ الإجراءات

## الملفات المعدلة

### `src/pages/AdminDashboard.tsx`
- إضافة متغيرات حالة للركاب
- إضافة دالة `fetchPassengers()` لجلب الركاب من Supabase
- إضافة دالة `togglePassengerStatus()` لتغيير حالة الحساب
- إضافة واجهة إدارة الركاب في لوحة التحكم

## كيفية الاستخدام

### للمدير:
1. تسجيل الدخول بحساب مدير
2. الانتقال إلى لوحة تحكم المدير (`/admin`)
3. البحث عن قسم "إدارة الركاب"
4. عرض قائمة الركاب
5. النقر على زر "إيقاف" أو "تفعيل" حسب الحاجة

### للركاب:
- **الحساب النشط**: يمكن الحجز والوصول لجميع الميزات
- **الحساب الموقوف**: لا يمكن الحجز أو الوصول للنظام

## الأمان والصلاحيات

### التحقق من الصلاحيات
```typescript
const isAdmin = profile?.role === 'admin' || profile?.role === 'developer';
```

### حماية قاعدة البيانات
- استخدام Row Level Security (RLS) في Supabase
- التحقق من صلاحيات المدير قبل تنفيذ الإجراءات

## قاعدة البيانات

### جدول `profiles`
- `account_suspended`: boolean - حالة إيقاف الحساب
- `role`: string - دور المستخدم ('passenger', 'driver', 'admin')

### الاستعلامات المستخدمة
```sql
-- جلب الركاب
SELECT * FROM profiles 
WHERE role = 'passenger' 
ORDER BY created_at DESC;

-- تحديث حالة الحساب
UPDATE profiles 
SET account_suspended = true/false 
WHERE id = 'passenger_id';
```

## الرسائل والإشعارات

### رسائل النجاح
- "تم إيقاف حساب الراكب بنجاح"
- "تم تفعيل حساب الراكب بنجاح"

### رسائل الخطأ
- "حدث خطأ أثناء تحديث حالة الحساب"

## التطوير المستقبلي

### ميزات مقترحة:
1. **البحث والتصفية**: إضافة إمكانية البحث في الركاب
2. **التجميع**: تجميع الركاب حسب الحالة
3. **التفاصيل**: عرض تفاصيل أكثر عن الراكب
4. **السجل**: تتبع تاريخ تغييرات الحالة
5. **الإشعارات**: إرسال إشعارات للركاب عند تغيير الحالة

### تحسينات الأداء:
1. **التصفح**: إضافة pagination للقوائم الطويلة
2. **التحديث**: تحديث تلقائي للحالة
3. **التخزين المؤقت**: تخزين مؤقت للبيانات

## الاختبار

### سيناريوهات الاختبار:
1. **المدير العادي**: يجب أن يتمكن من إدارة الركاب
2. **المستخدم العادي**: يجب ألا يتمكن من الوصول للوحة المدير
3. **إيقاف الحساب**: يجب أن يمنع الراكب من الحجز
4. **تفعيل الحساب**: يجب أن يعيد تفعيل جميع الميزات

### اختبارات الواجهة:
1. عرض قائمة الركاب بشكل صحيح
2. تحديث الحالة فورياً
3. رسائل التأكيد تظهر بشكل صحيح
4. التصميم متجاوب على جميع الأجهزة

## الدعم الفني

### المشاكل الشائعة:
1. **لا تظهر قائمة الركاب**: تحقق من اتصال Supabase
2. **لا يعمل تغيير الحالة**: تحقق من صلاحيات المدير
3. **رسائل الخطأ**: تحقق من سجلات المتصفح

### سجلات التطوير:
- استخدام `console.log` لتتبع العمليات
- مراقبة أخطاء Supabase في لوحة التحكم
- فحص Network tab في أدوات المطور

## الخلاصة

تم إضافة ميزة إدارة الركاب بنجاح في لوحة تحكم المدير. هذه الميزة تسمح للمديرين بالتحكم الكامل في حسابات الركاب، مما يحسن من إدارة النظام والأمان.

الميزة تعمل بشكل متكامل مع النظام الحالي وتستخدم نفس آليات الأمان والصلاحيات الموجودة.
