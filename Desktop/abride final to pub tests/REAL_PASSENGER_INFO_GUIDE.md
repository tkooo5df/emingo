# ุฅุถุงูุฉ ุงูุงุณู ุงูุญูููู ูุตูุฑุฉ ุงูุจุฑููุงูู ููุฑุงูุจ ูู ุงูุชููููุงุช

## ๐ฏ ุงููุฏู:
ุนุฑุถ ุงูุงุณู ุงูุญูููู ููุฑุงูุจ ูุตูุฑุฉ ุงูุจุฑููุงูู ุงููุญููุธุฉ ูู Supabase ุจุฏูุงู ูู "ุฑุงูุจ" ููุท.

## โ ุงูุชุญุฏูุซุงุช ุงูููุฌุฒุฉ:

### **1. ุชุญุฏูุซ ุฏุงูุฉ get_driver_ratings**
ุชู ุชุญุฏูุซ ุงูุฏุงูุฉ ูุชุดูู:
- `passenger_name` - ุงูุงุณู ุงูุญูููู ููุฑุงูุจ
- `passenger_avatar_url` - ุฑุงุจุท ุตูุฑุฉ ุงูุจุฑููุงูู
- `passenger_email` - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

### **2. ุชุญุฏูุซ ูููู DriverRatingsDisplay**
ุชู ุชุญุฏูุซ ุงููููู ูุงุณุชุฎุฏุงู:
- ุนุฑุถ ุงูุตูุฑุฉ ุงูุญููููุฉ ููุฑุงูุจ
- ุนุฑุถ ุงูุงุณู ุงูุญูููู ุจุฏูุงู ูู "ุฑุงูุจ"
- ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุชู ูุง ุชูุฌุฏ ูููุง ุตูุฑุฉ

## ๐ ุฎุทูุงุช ุงูุชุทุจูู:

### **ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ุฏุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช**
ุดุบู `database/update_ratings_function.sql` ูู Supabase SQL Editor:

```sql
-- ุฅูุดุงุก ุฏุงูุฉ ูุญุฏุซุฉ
CREATE OR REPLACE FUNCTION get_driver_ratings(driver_id UUID)
RETURNS TABLE (
    id INTEGER,
    booking_id INTEGER,
    passenger_id UUID,
    rating INTEGER,
    comment TEXT,
    created_at TIMESTAMP WITH TIME ZONE,
    passenger_name TEXT,
    passenger_avatar_url TEXT,
    passenger_email TEXT
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        r.id,
        r.booking_id,
        r.passenger_id,
        r.rating,
        r.comment,
        r.created_at,
        COALESCE(p.full_name, 'ุฑุงูุจ') as passenger_name,
        p.avatar_url as passenger_avatar_url,
        p.email as passenger_email
    FROM ratings r
    LEFT JOIN profiles p ON r.passenger_id = p.id
    WHERE r.driver_id = driver_id
    ORDER BY r.created_at DESC;
END;
$$ LANGUAGE plpgsql;
```

### **ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุงูููุฏ**
ุชู ุชุญุฏูุซ `DriverRatingsDisplay.tsx` ูุงุณุชุฎุฏุงู:
- `passengerAvatarUrl` ูุนุฑุถ ุงูุตูุฑุฉ
- `passengerName` ูุนุฑุถ ุงูุงุณู ุงูุญูููู
- ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุชู ูุง ุชูุฌุฏ ูููุง ุตูุฑุฉ

## ๐จ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ:

### **ุนุฑุถ ุงูุตูุฑุฉ**:
```typescript
<Avatar className="h-8 w-8">
  {rating.passengerAvatarUrl ? (
    <img 
      src={rating.passengerAvatarUrl} 
      alt={rating.passengerName || 'ุฑุงูุจ'}
      className="h-8 w-8 rounded-full object-cover"
    />
  ) : (
    <AvatarFallback>
      <User className="h-4 w-4" />
    </AvatarFallback>
  )}
</Avatar>
```

### **ุนุฑุถ ุงูุงุณู ุงูุญูููู**:
```typescript
<div className="text-sm font-medium">
  {rating.passengerName || 'ุฑุงูุจ'}
</div>
```

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ:

### **ูุจู ุงูุชุญุฏูุซ**:
- ๐ค ุฃููููุฉ ุงูุชุฑุงุถูุฉ
- ๐ "ุฑุงูุจ" ููุท
- โ ูุง ุชูุฌุฏ ุตูุฑุฉ ุดุฎุตูุฉ

### **ุจุนุฏ ุงูุชุญุฏูุซ**:
- ๐ผ๏ธ ุตูุฑุฉ ุงูุจุฑููุงูู ุงูุญููููุฉ
- ๐ค ุงูุงุณู ุงูุญูููู ููุฑุงูุจ
- โ ูุนูููุงุช ูุงููุฉ ูููุตูุฉ

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ:

1. **ุดุบู `database/update_ratings_function.sql`** ูู Supabase
2. **ุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู profiles** (full_name, avatar_url)
3. **ุฃุถู ุชูููู ุฌุฏูุฏ** ูู ูุงุฌูุฉ ุงูุฑุงูุจ
4. **ุชุญูู ูู ุธููุฑ ุงูุงุณู ูุงูุตูุฑุฉ** ูู ููู ุงูุณุงุฆู

## ๐ ููุงุญุธุงุช ูููุฉ:

- โ **ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงููุงุฑุบุฉ** - ุฅุฐุง ูู ุชูุฌุฏ ุตูุฑุฉุ ุชุธูุฑ ุฃููููุฉ ุงูุชุฑุงุถูุฉ
- โ **ูุนุงูุฌุฉ ุงูุฃุณูุงุก ุงูููููุฏุฉ** - ุฅุฐุง ูู ููุฌุฏ ุงุณูุ ูุธูุฑ "ุฑุงูุจ"
- โ **ุฃุฏุงุก ูุญุณู** - ุงุณุชุนูุงู ูุงุญุฏ ูุฌูุจ ุฌููุน ุงููุนูููุงุช
- โ **ุชูุงูู ูุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ** - ูุนูู ูุน ุงูุชููููุงุช ุงููุฏููุฉ

## ๐ ุงููุชูุฌุฉ:

ุจุนุฏ ุงูุชุญุฏูุซ:
- โ **ุฃุณูุงุก ุญููููุฉ** ููุฑูุงุจ ูู ุงูุชููููุงุช
- โ **ุตูุฑ ุจุฑููุงูู** ุญููููุฉ
- โ **ูุนูููุงุช ูุงููุฉ** ูููุตูุฉ
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ููุณุงุฆููู

**ุดุบู `database/update_ratings_function.sql` ูุณุชุญุตู ุนูู ุฃุณูุงุก ูุตูุฑ ุญููููุฉ!** ๐
