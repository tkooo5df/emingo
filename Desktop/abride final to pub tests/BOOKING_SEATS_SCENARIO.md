# ุณููุงุฑูู ูุชููุน ููุญุฌูุฒุงุช ูุงูููุงุนุฏ

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

### 1. ุนูุฏ ุฅูุดุงุก ุงูุฑุญูุฉ
- **ุงูุญุงูุฉ**: ุงูุณุงุฆู ููุดุฆ ุฑุญูุฉ ุฌุฏูุฏุฉ
- **ุงูุฅุฌุฑุงุก**: 
  - ูุชู ุชุนููู `total_seats` (ูุซูุงู: 4 ููุงุนุฏ)
  - ูุชู ุชุนููู `available_seats = total_seats` (4 ููุงุนุฏ ูุชุงุญุฉ)
- **ุงููุชูุฌุฉ**: ุงูุฑุญูุฉ ุฌุงูุฒุฉ ููุญุฌุฒ ูุน ุฌููุน ุงูููุงุนุฏ ูุชุงุญุฉ

**ูุซุงู**:
```
ุฑุญูุฉ ุฌุฏูุฏุฉ:
- total_seats: 4
- available_seats: 4
- status: "scheduled"
```

---

### 2. ุนูุฏ ุญุฌุฒ ุบูุฑ ููุซู (Pending)
- **ุงูุญุงูุฉ**: ุฑุงูุจ ูุญุฌุฒ ููุนุฏูู (2 seats) ุจุฏูู ุชุฃููุฏ ูู ุงูุณุงุฆู
- **ุงูุฅุฌุฑุงุก**:
  1. ูุชู ุฅูุดุงุก ุญุฌุฒ ุจุญุงูุฉ `status: "pending"`
  2. ูุชู ุงุณุชุฏุนุงุก `updateTripAvailability()` ููุฑุงู
  3. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ: `seatsBooked = 2`
  4. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุชุงุญุฉ: `available_seats = total_seats - seatsBooked = 4 - 2 = 2`
  5. ูุชู ุชุญุฏูุซ ุงูุฑุญูุฉ: `available_seats: 2`
- **ุงููุชูุฌุฉ**: ุงูููุงุนุฏ ุชูุญุฌุฒ ููุฑุงู ุญุชู ูู ูุงู ุงูุญุฌุฒ ุบูุฑ ููุซู

**ูุซุงู**:
```
ูุจู ุงูุญุฌุฒ:
- total_seats: 4
- available_seats: 4
- bookings: []

ุจุนุฏ ุงูุญุฌุฒ ุบูุฑ ุงูููุซู:
- total_seats: 4
- available_seats: 2  โ ุชู ุฅููุงุต 2 ููุนุฏ
- bookings: [{ id: 1, seats_booked: 2, status: "pending" }]
```

---

### 3. ุนูุฏ ุชุฃููุฏ ุงูุญุฌุฒ (Confirmed)
- **ุงูุญุงูุฉ**: ุงูุณุงุฆู ูุคูุฏ ุงูุญุฌุฒ ุบูุฑ ุงูููุซู
- **ุงูุฅุฌุฑุงุก**:
  1. ูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุญุฌุฒ: `status: "pending" โ "confirmed"`
  2. ูุชู ุงุณุชุฏุนุงุก `updateTripAvailability()` ุชููุงุฆูุงู
  3. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ: `seatsBooked = 2` (ููุณ ุงูุนุฏุฏ)
  4. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุชุงุญุฉ: `available_seats = 4 - 2 = 2` (ููุณ ุงูุนุฏุฏ)
  5. ูุง ููุฌุฏ ุชุบููุฑ ูู ุงูููุงุนุฏ ุงููุชุงุญุฉ
- **ุงููุชูุฌุฉ**: ุงูููุงุนุฏ ุชุจูู ูุญุฌูุฒุฉ (ูุง ุชุบููุฑ)

**ูุซุงู**:
```
ูุจู ุงูุชุฃููุฏ:
- total_seats: 4
- available_seats: 2
- bookings: [{ id: 1, seats_booked: 2, status: "pending" }]

ุจุนุฏ ุงูุชุฃููุฏ:
- total_seats: 4
- available_seats: 2  โ ูุง ุชุบููุฑ
- bookings: [{ id: 1, seats_booked: 2, status: "confirmed" }]
```

---

### 4. ุนูุฏ ุฅูุบุงุก ุงูุญุฌุฒ (Cancelled)
- **ุงูุญุงูุฉ**: ุงูุฑุงูุจ ุฃู ุงูุณุงุฆู ููุบูู ุงูุญุฌุฒ
- **ุงูุฅุฌุฑุงุก**:
  1. ูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุญุฌุฒ: `status: "confirmed" โ "cancelled"`
  2. ูุชู ุงุณุชุฏุนุงุก `updateTripAvailability()` ุชููุงุฆูุงู
  3. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ: `seatsBooked = 0` (ูุฃู ุงูุญุฌูุฒุงุช ุงูููุบูุฉ ูุง ุชูุญุณุจ)
  4. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุชุงุญุฉ: `available_seats = 4 - 0 = 4`
  5. ูุชู ุชุญุฏูุซ ุงูุฑุญูุฉ: `available_seats: 4`
- **ุงููุชูุฌุฉ**: ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ ุชุนูุฏ ููุฑุญูุฉ

**ูุซุงู**:
```
ูุจู ุงูุฅูุบุงุก:
- total_seats: 4
- available_seats: 2
- bookings: [{ id: 1, seats_booked: 2, status: "confirmed" }]

ุจุนุฏ ุงูุฅูุบุงุก:
- total_seats: 4
- available_seats: 4  โ ุชู ุฅุฑุฌุงุน 2 ููุนุฏ
- bookings: [{ id: 1, seats_booked: 2, status: "cancelled" }]
```

---

### 5. ุฅูุบุงุก ุงูุญุฌูุฒุงุช ุบูุฑ ุงูููุซูุฉ ุจุนุฏ 24 ุณุงุนุฉ (Auto-Cancel)
- **ุงูุญุงูุฉ**: ุญุฌุฒ ุบูุฑ ููุซู ูุถู ุนููู ุฃูุซุฑ ูู 24 ุณุงุนุฉ
- **ุงูุฅุฌุฑุงุก**:
  1. Edge Function `cancel-expired-bookings` ุชุนูู ุจุดูู ุฏูุฑู (cron job)
  2. ูุชู ุงูุจุญุซ ุนู ุงูุญุฌูุฒุงุช: `status: "pending" AND created_at < (now - 24 hours)`
  3. ููู ุญุฌุฒ ููุชูู:
     - ุชุญุฏูุซ ุงูุญุฌุฒ: `status: "pending" โ "cancelled"`
     - ุงุณุชุฏุนุงุก `updateTripAvailability()` ูุฅุนุงุฏุฉ ุงูููุงุนุฏ
  4. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ: `seatsBooked = 0` (ูุฃู ุงูุญุฌูุฒุงุช ุงูููุบูุฉ ูุง ุชูุญุณุจ)
  5. ูุชู ุญุณุงุจ ุงูููุงุนุฏ ุงููุชุงุญุฉ: `available_seats = total_seats`
- **ุงููุชูุฌุฉ**: ุงูููุงุนุฏ ุงููุญุฌูุฒุฉ ุชุนูุฏ ููุฑุญูุฉ ุชููุงุฆูุงู

**ูุซุงู**:
```
ูุจู ุงูุฅูุบุงุก ุงูุชููุงุฆู (ุจุนุฏ 24 ุณุงุนุฉ):
- total_seats: 4
- available_seats: 2
- bookings: [{ id: 1, seats_booked: 2, status: "pending", created_at: "2025-01-04T10:00:00Z" }]
- ุงูููุช ุงูุญุงูู: "2025-01-05T10:00:01Z" (ุฃูุซุฑ ูู 24 ุณุงุนุฉ)

ุจุนุฏ ุงูุฅูุบุงุก ุงูุชููุงุฆู:
- total_seats: 4
- available_seats: 4  โ ุชู ุฅุฑุฌุงุน 2 ููุนุฏ ุชููุงุฆูุงู
- bookings: [{ id: 1, seats_booked: 2, status: "cancelled" }]
```

---

## ๐ ุณููุงุฑูู ูุชูุงูู

### ุงูุณููุงุฑูู ุงููุงูู:

**ุงูุฎุทูุฉ 1**: ุงูุณุงุฆู ููุดุฆ ุฑุญูุฉ
```
ุฑุญูุฉ ุฌุฏูุฏุฉ:
- total_seats: 4
- available_seats: 4
- status: "scheduled"
```

**ุงูุฎุทูุฉ 2**: ุฑุงูุจ 1 ูุญุฌุฒ ููุนุฏูู (ุบูุฑ ููุซู)
```
- total_seats: 4
- available_seats: 2  โ ุชู ุฅููุงุต 2
- bookings: [{ id: 1, seats_booked: 2, status: "pending" }]
```

**ุงูุฎุทูุฉ 3**: ุฑุงูุจ 2 ูุญุฌุฒ ููุนุฏ ูุงุญุฏ (ุบูุฑ ููุซู)
```
- total_seats: 4
- available_seats: 1  โ ุชู ุฅููุงุต 1
- bookings: [
    { id: 1, seats_booked: 2, status: "pending" },
    { id: 2, seats_booked: 1, status: "pending" }
  ]
```

**ุงูุฎุทูุฉ 4**: ุงูุณุงุฆู ูุคูุฏ ุญุฌุฒ ุฑุงูุจ 1
```
- total_seats: 4
- available_seats: 1  โ ูุง ุชุบููุฑ
- bookings: [
    { id: 1, seats_booked: 2, status: "confirmed" },
    { id: 2, seats_booked: 1, status: "pending" }
  ]
```

**ุงูุฎุทูุฉ 5**: ุฑุงูุจ 2 ููุบู ุญุฌุฒู
```
- total_seats: 4
- available_seats: 2  โ ุชู ุฅุฑุฌุงุน 1 ููุนุฏ
- bookings: [
    { id: 1, seats_booked: 2, status: "confirmed" },
    { id: 2, seats_booked: 1, status: "cancelled" }
  ]
```

**ุงูุฎุทูุฉ 6**: ุฑุงูุจ 3 ูุญุฌุฒ ููุนุฏูู (ุบูุฑ ููุซู)
```
- total_seats: 4
- available_seats: 0  โ ุชู ุฅููุงุต 2
- status: "fully_booked"
- bookings: [
    { id: 1, seats_booked: 2, status: "confirmed" },
    { id: 2, seats_booked: 1, status: "cancelled" },
    { id: 3, seats_booked: 2, status: "pending" }
  ]
```

**ุงูุฎุทูุฉ 7**: ุจุนุฏ 24 ุณุงุนุฉุ ุญุฌุฒ ุฑุงูุจ 3 ูููุบู ุชููุงุฆูุงู
```
- total_seats: 4
- available_seats: 2  โ ุชู ุฅุฑุฌุงุน 2 ููุนุฏ ุชููุงุฆูุงู
- status: "scheduled"
- bookings: [
    { id: 1, seats_booked: 2, status: "confirmed" },
    { id: 2, seats_booked: 1, status: "cancelled" },
    { id: 3, seats_booked: 2, status: "cancelled" }
  ]
```

---

## ๐ ุงูููุงุท ุงููููุฉ

1. **ุงูููุงุนุฏ ุชูุญุฌุฒ ููุฑุงู ุนูุฏ ุงูุญุฌุฒ ุบูุฑ ุงูููุซู**: ูุฐุง ูููุน ุงูุญุฌุฒ ุงูุฒุงุฆุฏ (overbooking)

2. **ุงูุชุฃููุฏ ูุง ูุบูุฑ ุงูููุงุนุฏ**: ูุฃู ุงูููุงุนุฏ ุชู ุฅููุงุตูุง ุจุงููุนู ุนูุฏ ุงูุญุฌุฒ

3. **ุงูุฅูุบุงุก ูุนูุฏ ุงูููุงุนุฏ**: ูุฃู `updateTripAvailability()` ุชุญุณุจ ููุท ุงูุญุฌูุฒุงุช ุงููุดุทุฉ

4. **ุงูุฅูุบุงุก ุงูุชููุงุฆู ุจุนุฏ 24 ุณุงุนุฉ**: ูููุน ุงุญุชุฌุงุฒ ุงูููุงุนุฏ ููุชุฑุฉ ุทูููุฉ ุจุฏูู ุชุฃููุฏ

5. **ุงูุญุณุงุจ ุฏููู ุฏุงุฆูุงู**: `available_seats = total_seats - sum(seats_booked where status in ['pending', 'confirmed', 'in_progress', 'completed'])`

---

## ๐๏ธ ููููุฉ ุชูุนูู Edge Function

ูุชูุนูู ุงูุฅูุบุงุก ุงูุชููุงุฆู ููุญุฌูุฒุงุช ุงูููุชููุฉุ ูุฌุจ ุฅุนุฏุงุฏ cron job ูู Supabase:

1. ุงุฐูุจ ุฅูู Supabase Dashboard โ Edge Functions
2. ุฃูุดุฆ cron job ุฌุฏูุฏ:
   - Schedule: `0 */6 * * *` (ูู 6 ุณุงุนุงุช)
   - Function: `cancel-expired-bookings`
3. ุฃู ุงุณุชุฎุฏู Supabase CLI:
   ```bash
   supabase functions deploy cancel-expired-bookings
   ```

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-01-05

