# ุฅุตูุงุญ ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงูุณุงุฆู - Fix Driver Stats Calculation

## ๐ ุงููุดููุฉ

ูุงู ูุธูุฑ ููุณุงุฆู:
- **1 ุฑุญูุฉ ููุชููุฉ**
- **158 ุญุฌุฒ**

ูุฐุง ูุถูู! ูุฃู ุงูููุฏ ูุงู ูุนุฑุถ:
- ุนุฏุฏ ุงูุฑุญูุงุช **ุงูููุชููุฉ ููุท** (1 ุฑุญูุฉ)
- ุนุฏุฏ ุงูุญุฌูุฒุงุช ูู **ุฌููุน ุงูุฑุญูุงุช** (ููุชููุฉ + ูุฌุฏููุฉ) = 158 ุญุฌุฒ

---

## โ ุงูุญู ุงูููุทุจู

### ุงูุชุบููุฑ 1: ุฅุถุงูุฉ `totalTrips`

**ูุจู:**
```typescript
let completedTrips = 0; // ููุท ุงูููุชููุฉ
```

**ุจุนุฏ:**
```typescript
let totalTrips = 0;      // ุฌููุน ุงูุฑุญูุงุช
let completedTrips = 0;  // ุงูููุชููุฉ ููุท
```

---

### ุงูุชุบููุฑ 2: ุญุณุงุจ ุฌููุน ุงูุฑุญูุงุช

**ูุจู:**
```typescript
completedTrips = tripsData?.filter((t: any) => t.status === 'completed').length || 0;
```

**ุจุนุฏ:**
```typescript
// Count ALL trips (scheduled + completed + cancelled)
totalTrips = tripsData?.length || 0;

// Count only completed trips
completedTrips = tripsData?.filter((t: any) => t.status === 'completed').length || 0;
```

---

### ุงูุชุบููุฑ 3: ุชุญุฏูุซ ุงููุงุฌูุฉ

**ูุจู:**
```tsx
<div>
  {completedTrips}
  <span>ุฑุญูุงุช ููุชููุฉ</span>
</div>
```

**ุจุนุฏ:**
```tsx
<div>
  {totalTrips}
  <span>ุฅุฌูุงูู ุงูุฑุญูุงุช</span>
  {completedTrips > 0 && (
    <div className="text-xs">{completedTrips} ููุชููุฉ</div>
  )}
</div>
```

---

## ๐ ุงููุชูุฌุฉ ุงูุขู

ุณูุธูุฑ ููุณุงุฆู:

```
โโโโโโโโโโโโโโโโโโโโ
โ   ุฅุฌูุงูู ุงูุฑุญูุงุช  โ
โ        11        โ
โ    1 ููุชููุฉ      โ
โโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโ
โ   ููุงุนุฏ ูุญุฌูุฒุฉ   โ
โ       158        โ
โโโโโโโโโโโโโโโโโโโโ
```

ุงูุขู ุงููุนูููุงุช **ููุทููุฉ**:
- 11 ุฑุญูุฉ ุฅุฌูุงููุฉ (ูุฌุฏููุฉ + ููุชููุฉ)
- 1 ุฑุญูุฉ ููุชููุฉ
- 158 ููุนุฏ ูุญุฌูุฒ ุนุจุฑ ุฌููุน ุงูุฑุญูุงุช

---

## ๐ ููููุฉ ุงูุชุญูู

### 1. ุดุบูู ุณูุฑูุจุช ุงูุชุดุฎูุต

ูู Supabase SQL Editorุ ุดุบูู ููู **`DEBUG_DRIVER_STATS.sql`**:

```sql
-- ุงุณุชุจุฏู UUID ุงูุณุงุฆู
SELECT 
    (SELECT COUNT(*) FROM trips WHERE driver_id = 'your-uuid') AS total_trips,
    (SELECT COUNT(*) FROM trips WHERE driver_id = 'your-uuid' AND status = 'completed') AS completed_trips,
    (SELECT COUNT(*) FROM bookings WHERE driver_id = 'your-uuid') AS total_bookings;
```

### 2. ุชุญูู ูู ุงููุชุงุฆุฌ

ูุฌุจ ุฃู ุชุฑู:
- `total_trips` = 11 (ูุซูุงู)
- `completed_trips` = 1
- `total_bookings` = 158

---

## ๐ ูููุงุช ุชู ุชุนุฏูููุง

1. โ `src/components/profile/Profile.tsx`
   - ุฅุถุงูุฉ `totalTrips` ููู `DriverProfileData` interface
   - ุญุณุงุจ `totalTrips` ูู ุฌููุน ุงูุฑุญูุงุช
   - ุชุญุฏูุซ ุงูุนุฑุถ ูุฅุธูุงุฑ ุฅุฌูุงูู ุงูุฑุญูุงุช + ุงูููุชููุฉ

2. โ `DEBUG_DRIVER_STATS.sql` (ุฌุฏูุฏ)
   - ุณูุฑูุจุช ุชุดุฎูุต ุดุงูู
   - ููุดู ุฌููุน ุงููุดุงูู ูู ุงูุจูุงูุงุช
   - ูุนุฑุถ ุชุญููู ุชูุตููู

---

## ๐ฏ ุงููุงุฆุฏุฉ

ุงูุขู ุงูุฅุญุตุงุฆูุงุช **ุฏูููุฉ ููุงุถุญุฉ**:

| ุงูุฅุญุตุงุฆูุฉ | ูุง ุชุนููู | ุงููุตุฏุฑ |
|-----------|---------|--------|
| ุฅุฌูุงูู ุงูุฑุญูุงุช | ุฌููุน ุงูุฑุญูุงุช (ูุฌุฏููุฉ + ููุชููุฉ + ููุบุงุฉ) | `trips` |
| ููุชููุฉ | ุนุฏุฏ ุงูุฑุญูุงุช ุงูููุชููุฉ ููุท | `trips WHERE status = 'completed'` |
| ููุงุนุฏ ูุญุฌูุฒุฉ | ูุฌููุน ุงูููุงุนุฏ ูู ุฌููุน ุงูุญุฌูุฒุงุช | `SUM(bookings.seats_booked)` |
| ุญุฌูุฒุงุช ููุชููุฉ | ุนุฏุฏ ุงูุญุฌูุฒุงุช ุงูููุชููุฉ | `bookings WHERE status = 'completed'` |
| ุงูุฃุฑุจุงุญ | ูุฌููุน ุงููุจุงูุบ ูู ุฌููุน ุงูุญุฌูุฒุงุช | `SUM(bookings.total_amount)` |

---

## ๐ก ูุตุงุฆุญ ุฅุถุงููุฉ

### ููุชุญูู ูู ุงูุฏูุฉ:

```sql
-- ุชุญูู ูู ุชูุฒูุน ุญุงูุงุช ุงูุฑุญูุงุช
SELECT 
    status,
    COUNT(*) AS count
FROM trips
WHERE driver_id = 'your-uuid'
GROUP BY status;

-- ุชุญูู ูู ุงูุญุฌูุฒุงุช ููู ุฑุญูุฉ
SELECT 
    t.id,
    t.status,
    COUNT(b.id) AS bookings_count,
    SUM(b.seats_booked) AS seats_booked
FROM trips t
LEFT JOIN bookings b ON t.id = b.trip_id
WHERE t.driver_id = 'your-uuid'
GROUP BY t.id, t.status
ORDER BY bookings_count DESC;
```

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-10-23  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ  
**ุงููุชูุฌุฉ:** ุฅุญุตุงุฆูุงุช ุฏูููุฉ ูููุทููุฉ

