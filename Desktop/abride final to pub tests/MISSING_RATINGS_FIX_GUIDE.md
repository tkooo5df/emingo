# ุญู ูุดููุฉ ุงุฎุชูุงุก ุงูุชููููุงุช ุงูุณุงุจูุฉ

## ๐จ ุงููุดููุฉ:
ููุฏ ุงุฎุชูุช ูู ุงูุชููููุงุช ุงูุณุงุจูุฉ ุจุนุฏ ุชุญุฏูุซ ุงูุฏุงูุฉ.

## ๐ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:

### **1. ุงูุชููููุงุช ููุฌูุฏุฉ ููู ุงูุฏุงูุฉ ูุง ุชุฌุฏูุง**
- ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ ููุง ูุดููุฉ ูู ุงูุงุณุชุนูุงู
- ูุดููุฉ ูู ุฑุจุท ุงูุฌุฏุงูู
- ูุดููุฉ ูู ููุน ุงูุจูุงูุงุช

### **2. ุงูุชููููุงุช ูุญุฐููุฉ ูุนูุงู**
- ุญุฐู ุบูุฑ ููุตูุฏ ููุจูุงูุงุช
- ูุดููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุดููุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู

### **3. ูุดููุฉ ูู ุนุฑุถ ุงูุชููููุงุช**
- ูุดููุฉ ูู ุงูููุฏ ุงูุฃูุงูู
- ูุดููุฉ ูู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ
- ูุดููุฉ ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช

## โ ุงูุญู:

### **ุงูุฎุทูุฉ 1: ูุญุต ุงูุชููููุงุช ุงูููุฌูุฏุฉ**
ุดุบู `database/restore_missing_ratings.sql` ูู Supabase SQL Editor ููุญุต:

1. **ุฌุฏูู ratings** - ูู ุงูุชููููุงุช ููุฌูุฏุฉุ
2. **ุนุฏุฏ ุงูุชููููุงุช** - ูู ุนุฏุฏ ุงูุชููููุงุช ููู ุณุงุฆูุ
3. **ูุนูููุงุช ุงูุฑุงูุจ** - ูู ูุฑุชุจุทุฉ ุจุดูู ุตุญูุญุ
4. **ุงุฎุชุจุงุฑ ุงูุฏุงูุฉ** - ูู ุชุนูู ุจุดูู ุตุญูุญุ

### **ุงูุฎุทูุฉ 2: ุชุดุฎูุต ุงููุดููุฉ**
```sql
-- ูุญุต ุงูุชููููุงุช ุงูููุฌูุฏุฉ
SELECT COUNT(*) as total_ratings FROM ratings;

-- ูุญุต ุงูุชููููุงุช ููู ุณุงุฆู
SELECT 
    driver_id,
    COUNT(*) as ratings_count
FROM ratings 
GROUP BY driver_id;

-- ูุญุต ุงูุชููููุงุช ูุน ูุนูููุงุช ุงูุฑุงูุจ
SELECT 
    r.id,
    r.driver_id,
    r.passenger_id,
    r.rating,
    r.comment,
    r.created_at,
    p.full_name as passenger_name
FROM ratings r
LEFT JOIN profiles p ON r.passenger_id = p.id
ORDER BY r.created_at DESC;
```

### **ุงูุฎุทูุฉ 3: ุฅุตูุงุญ ุงูุฏุงูุฉ**
```sql
-- ุญุฐู ุงูุฏุงูุฉ ุงููุฏููุฉ
DROP FUNCTION IF EXISTS get_driver_ratings(UUID);

-- ุฅูุดุงุก ุฏุงูุฉ ุฌุฏูุฏุฉ ูุน ุชุณุฌูู ููุตู
CREATE FUNCTION get_driver_ratings(driver_id UUID)
RETURNS TABLE (
    id INTEGER,
    booking_id INTEGER,
    passenger_id UUID,
    rating INTEGER,
    comment TEXT,
    created_at TIMESTAMP WITH TIME ZONE,
    passenger_name TEXT,
    passenger_avatar_url TEXT,
    passenger_email TEXT
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        r.id,
        r.booking_id,
        r.passenger_id,
        r.rating,
        r.comment,
        r.created_at,
        COALESCE(p.full_name, 'ุฑุงูุจ') as passenger_name,
        CASE 
            WHEN p.avatar_url IS NOT NULL AND p.avatar_url != '' THEN 
                'https://kobsavfggcnfemdzsnpj.supabase.co/storage/v1/object/public/avatars/' || p.avatar_url
            ELSE NULL 
        END as passenger_avatar_url,
        p.email as passenger_email
    FROM ratings r
    LEFT JOIN profiles p ON r.passenger_id = p.id
    WHERE r.driver_id = driver_id
    ORDER BY r.created_at DESC;
END;
$$ LANGUAGE plpgsql;
```

## ๐ ุฎุทูุงุช ุงูุชุดุฎูุต:

### **1. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- ุดุบู `database/restore_missing_ratings.sql`
- ุชุญูู ูู ูุฌูุฏ ุงูุชููููุงุช ูู ุฌุฏูู `ratings`
- ุชุญูู ูู ุนุฏุฏ ุงูุชููููุงุช ููู ุณุงุฆู

### **2. ูุญุต ุงูุฏุงูุฉ**
- ุงุฎุชุจุฑ ุงูุฏุงูุฉ ูุน ูุนุฑู ุณุงุฆู ุญูููู
- ุชุญูู ูู ุงููุชุงุฆุฌ ุงููุฑุฌุนุฉ
- ุชุญูู ูู ูุฌูุฏ ุฃุฎุทุงุก

### **3. ูุญุต ุงูููุฏ ุงูุฃูุงูู**
- ุงูุชุญ Developer Tools (F12)
- ุงูุชูู ุฅูู Console
- ุงุจุญุซ ุนู ุฑุณุงุฆู `DriverRatingsDisplay`
- ุชุญูู ูู ูุฌูุฏ ุฃุฎุทุงุก

## ๐ ุงูุญููู ุงูุณุฑูุนุฉ:

### **ุฅุฐุง ูุงูุช ุงูุชููููุงุช ููุฌูุฏุฉ:**
1. **ุดุบู `database/restore_missing_ratings.sql`** ููุญุต ุงูุจูุงูุงุช
2. **ุงุฎุชุจุฑ ุงูุฏุงูุฉ** ูุน ูุนุฑู ุณุงุฆู ุญูููู
3. **ุชุญูู ูู Console** ูู ุงูุชุทุจูู

### **ุฅุฐุง ูุงูุช ุงูุชููููุงุช ููููุฏุฉ:**
1. **ูุญุต ุงููุณุฎ ุงูุงุญุชูุงุทู** ุฅุฐุง ูุงู ูุชุงุญุงู
2. **ุฅุนุงุฏุฉ ุฅุถุงูุฉ ุงูุชููููุงุช** ุจุงุณุชุฎุฏุงู `database/add_real_ratings.sql`
3. **ุชุญุฏูุซ ุงูุฏุงูุฉ** ูุชุนูู ูุน ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### **ุฅุฐุง ูุงูุช ุงููุดููุฉ ูู ุงูุนุฑุถ:**
1. **ุชุญุฏูุซ ุงูููุฏ ุงูุฃูุงูู** ูุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุจุดูู ุตุญูุญ
2. **ูุญุต ูุนุงูุฌุฉ ุงูุจูุงูุงุช** ูู `DriverRatingsDisplay`
3. **ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ** ูู Console

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ:

### **ุฅุฐุง ูุงูุช ุงูุชููููุงุช ููุฌูุฏุฉ:**
- โ **ุนุฏุฏ ุงูุชููููุงุช** ูุธูุฑ ูู ุงููุชุงุฆุฌ
- โ **ูุนูููุงุช ุงูุฑุงูุจ** ูุฑุชุจุทุฉ ุจุดูู ุตุญูุญ
- โ **ุงูุฏุงูุฉ ุชุนูู** ุจุฏูู ุฃุฎุทุงุก

### **ุฅุฐุง ูุงูุช ุงูุชููููุงุช ููููุฏุฉ:**
- โ **ุนุฏุฏ ุงูุชููููุงุช** = 0
- โ **ุฌุฏูู ratings** ูุงุฑุบ
- โ **ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุฅุถุงูุฉ** ุงูุชููููุงุช

## ๐ง ุฅุนุงุฏุฉ ุฅุถุงูุฉ ุงูุชููููุงุช:

### **ุฅุฐุง ูุงูุช ุงูุชููููุงุช ููููุฏุฉ ูุนูุงู:**
```sql
-- ุฅุถุงูุฉ ุงูุชููููุงุช ูุฑุฉ ุฃุฎุฑู
INSERT INTO ratings (booking_id, driver_id, passenger_id, rating, comment) VALUES
(2, '9f0de29e-4211-463a-aa2d-d20074921e84', '3414418a-a5e0-4ea2-be32-72eadc2645b7', 5, 'ุณุงุฆู ููุชุงุฒ ูููุฐุจ'),
(10, 'b7ed3c49-7645-4d27-87ed-d03d1f7660d5', '4d8c32b3-6590-47cc-8f5b-73c17b383524', 4, 'ุณุงุฆู ุฌูุฏุ ุฑุญูุฉ ุขููุฉ');
```

## ๐ ููุงุญุธุงุช ูููุฉ:

- โ **ูุญุต ุดุงูู** - ููุจูุงูุงุช ูุงูุฏุงูุฉ ูุงูููุฏ
- โ **ุชุดุฎูุต ููุตู** - ููุนุฑูุฉ ุงูุณุจุจ ุงูุฏููู
- โ **ุญููู ูุชุนุฏุฏุฉ** - ุญุณุจ ููุน ุงููุดููุฉ
- โ **ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช** - ุฅุฐุง ูุงูุช ููููุฏุฉ

## ๐ ุงููุชูุฌุฉ:

ุจุนุฏ ุงูุชุดุฎูุต ูุงูุญู:
- โ **ุงูุชููููุงุช ููุฌูุฏุฉ** ุฃู ูุณุชุนุงุฏุฉ
- โ **ุงูุฏุงูุฉ ุชุนูู** ุจุดูู ุตุญูุญ
- โ **ุงูุนุฑุถ ูุนูู** ูู ุงูุชุทุจูู
- โ **ุงูุตูุฑ ูุงูุฃุณูุงุก** ุชุธูุฑ ุจุดูู ุตุญูุญ

**ุดุบู `database/restore_missing_ratings.sql` ุฃููุงู ููุนุฑูุฉ ุงูุณุจุจ ุงูุฏููู!** ๐
