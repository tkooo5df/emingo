# ุญู ูุดููุฉ ุญูุธ ุงูุชูููู - ON CONFLICT Error

## ๐จ ุงููุดููุฉ:
```
ERROR: there is no unique or exclusion constraint matching the ON CONFLICT specification
```

## ๐ ุงูุณุจุจ:
ุฌุฏูู `ratings` ูุง ูุญุชูู ุนูู constraint ูุฑูุฏ ูููุนุงููุงุช `booking_id,passenger_id` ุงููุญุฏุฏุฉ ูู `onConflict`.

## โ ุงูุญู:

### **ุงูุฎุทูุฉ 1: ุฅุตูุงุญ ุงูููุฏ**
ุชู ุชุนุฏูู `RatingSection.tsx` ูุงุณุชุฎุฏุงู ููุทู `INSERT` ุฃู `UPDATE` ุจุฏูุงู ูู `UPSERT`:

```typescript
// ุชุญูู ูู ูุฌูุฏ ุชูููู ุณุงุจู
const { data: existingRating } = await supabase
  .from('ratings')
  .select('id')
  .eq('booking_id', bookingId)
  .eq('passenger_id', user.id)
  .single();

if (existingRating) {
  // ุชุญุฏูุซ ุงูุชูููู ุงูููุฌูุฏ
  await supabase
    .from('ratings')
    .update({ rating, comment, updated_at: currentDate })
    .eq('id', existingRating.id);
} else {
  // ุฅุฏุฑุงุฌ ุชูููู ุฌุฏูุฏ
  await supabase
    .from('ratings')
    .insert({
      booking_id: bookingId,
      driver_id: driverId,
      passenger_id: user.id,
      rating,
      comment,
      created_at: currentDate,
      updated_at: currentDate
    });
}
```

### **ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ Constraint ูุฑูุฏ (ุงุฎุชูุงุฑู)**
ุดุบู `database/add_unique_constraint.sql` ูุชุญุณูู ุงูุฃุฏุงุก:

```sql
-- ุฅุถุงูุฉ constraint ูุฑูุฏ
ALTER TABLE ratings 
ADD CONSTRAINT unique_booking_passenger_rating 
UNIQUE (booking_id, passenger_id);
```

## ๐ฏ ุงููููุฒุงุช:

### **ุงูุญู ุงูุฌุฏูุฏ**:
- โ **ูุนูู ุจุฏูู constraints** - ูุง ูุญุชุงุฌ ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ููุทู ูุงุถุญ** - ุชุญูู ุฃููุงู ุซู ุฅุฏุฑุงุฌ ุฃู ุชุญุฏูุซ
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ **ููุน ุงูุชูุฑุงุฑ** - ูุง ูููู ุฅุถุงูุฉ ุชูููู ููุฑุฑ

### **ุงูุชุญุณููุงุช**:
- โ **ุฃุฏุงุก ุฃูุถู** - ุงุณุชุนูุงู ูุงุญุฏ ููุชุญูู
- โ **ุฃูุงู ุฃูุจุฑ** - ุชุญูู ูู ูุฌูุฏ ุงูุชูููู ูุจู ุงูุชุญุฏูุซ
- โ **ูุฑููุฉ** - ูุนูู ูุน ุฃู ูููู ุฌุฏูู

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ:

1. **ุชุฃูุฏ ูู ุฅูุดุงุก ุฌุฏูู ratings** (ุดุบู `database/create_ratings_table.sql`)
2. **ุงุฎุชุจุฑ ุฅุถุงูุฉ ุชูููู ุฌุฏูุฏ** ูู ุงูุชุทุจูู
3. **ุงุฎุชุจุฑ ุชุนุฏูู ุชูููู ููุฌูุฏ** ูู ุงูุชุทุจูู
4. **ุชุญูู ูู ุธููุฑ ุงูุชูููู** ูู ููุญุฉ ุชุญูู ุงูุณุงุฆู

## ๐ ููุงุญุธุงุช:

- โ **ูุง ูุญุชุงุฌ ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช** - ุงูุญู ูุนูู ููุฑุงู
- โ **Constraint ูุฑูุฏ ุงุฎุชูุงุฑู** - ูุชุญุณูู ุงูุฃุฏุงุก ููุท
- โ **ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก** - ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ **ููุน ุงูุชูุฑุงุฑ** - ูุง ูููู ุฅุถุงูุฉ ุชูููู ููุฑุฑ ูููุณ ุงูุญุฌุฒ

## ๐ ุงููุชูุฌุฉ:

ุจุนุฏ ูุฐุง ุงูุชุนุฏูู:
- โ **ุญูุธ ุงูุชููููุงุช ูุนูู** ุจุฏูู ุฃุฎุทุงุก
- โ **ุชุนุฏูู ุงูุชููููุงุช ูุนูู** ุจุดูู ุตุญูุญ
- โ **ููุน ุงูุชูุฑุงุฑ** ุชููุงุฆูุงู
- โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** ูููุณุชุฎุฏู

**ุงููุดููุฉ ูุญูููุฉ! ุฌุฑุจ ุฅุถุงูุฉ ุชูููู ุงูุขู** ๐
