# ุณูุงุณุฉ ุฅููุงู ุงูุญุณุงุจ ุจุณุจุจ ุญุฐู ุงูุฑุญูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ุณูุงุณุฉ ุฌุฏูุฏุฉ ุชููุน ุงูุณุงุฆููู ูู ุญุฐู ุงูุฑุญูุงุช ุจุดูู ูุชูุฑุฑ. ุฅุฐุง ูุงู ุงูุณุงุฆู ุจุญุฐู 3 ุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉุ ุณูุชู ุฅููุงู ุญุณุงุจู ุชููุงุฆูุงู.

---

## ๐ง ุงูููููุงุช ุงูุชูููุฉ

### 1. ุฌุฏูู `trip_deletions`
ูุชู ุชุณุฌูู ูู ุญุฐู ุฑุญูุฉ ูู ูุฐุง ุงูุฌุฏูู:
- `driver_id`: ูุนุฑู ุงูุณุงุฆู
- `trip_id`: ูุนุฑู ุงูุฑุญูุฉ ุงููุญุฐููุฉ
- `deleted_at`: ููุช ุงูุญุฐู
- `deletion_reason`: ุณุจุจ ุงูุญุฐู (ุงุฎุชูุงุฑู)

### 2. ุงูุฏูุงู ูู Supabase

#### `count_trip_deletions_last_24h(driver_uuid)`
- ุชุญุณุจ ุนุฏุฏ ุญุฐู ุงูุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉ
- ุชูุณุชุฎุฏู ูุจู ุงูุญุฐู ูุฅุธูุงุฑ ุงูุชุญุฐูุฑุงุช

#### `suspend_driver_for_trip_deletions(driver_uuid, deletion_count)`
- ุชููู ุจุฅููุงู ุญุณุงุจ ุงูุณุงุฆู ุชููุงุฆูุงู
- ุชุญุฏุซ `account_suspended = TRUE` ูู ุฌุฏูู `profiles`
- ุชุถูู ุณุฌู ูู `account_suspensions`
- ุชูุดุฆ ุฅุดุนุงุฑ ููุณุงุฆู

#### `handle_trip_deletion()`
- Trigger function ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุญุฐู ุฑุญูุฉ
- ุชุณุฌู ุงูุญุฐู ูู `trip_deletions`
- ุชุญุณุจ ุนุฏุฏ ุงูุญุฐู ูู ุขุฎุฑ 24 ุณุงุนุฉ
- ุฅุฐุง ูุตู ุฅูู 3ุ ุชุณุชุฏุนู `suspend_driver_for_trip_deletions`

### 3. Trigger ูู Supabase
- `trigger_trip_deletion_tracking`: ูุชู ุชูุนููู ุนูุฏ `DELETE` ุนูู ุฌุฏูู `trips`
- ูุนูู ุชููุงุฆูุงู ุฏูู ุชุฏุฎู ูู ุงูููุฏ

---

## ๐ฏ ููููุฉ ุงูุนูู

### ุนูุฏ ุญุฐู ุฑุญูุฉ:

1. **ูุจู ุงูุญุฐู**:
   - ูุชู ุงูุชุญูู ูู ุนุฏุฏ ุญุฐู ุงูุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉ
   - ูุชู ุฅุธูุงุฑ ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ ููุณุงุฆู:
     - ุฅุฐุง ูุงู ูุฏูู 0 ุญุฐู: "ููุงุญุธุฉ: ุญุฐู 3 ุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉ ุณูุคุฏู ุฅูู ุฅููุงู ุญุณุงุจู ุชููุงุฆูุงู."
     - ุฅุฐุง ูุงู ูุฏูู 1 ุญุฐู: "ูุฏูู 1 ุญุฐู ูู ุขุฎุฑ 24 ุณุงุนุฉ. ุจุงูู 1 ุญุฐู ูุจู ุฅููุงู ุญุณุงุจู."
     - ุฅุฐุง ูุงู ูุฏูู 2 ุญุฐู: "โ๏ธ ุชุญุฐูุฑ: ูุฐู ูู ุงูุฑุญูุฉ ุงูุซุงูุซุฉ ุงูุชู ุชุญุฐููุง ูู ุขุฎุฑ 24 ุณุงุนุฉ. ุณูุชู ุฅููุงู ุญุณุงุจู ุชููุงุฆูุงู ุจุนุฏ ูุฐุง ุงูุญุฐู."

2. **ุฃุซูุงุก ุงูุญุฐู**:
   - ูุชู ุญุฐู ุงูุฑุญูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงูู trigger `trigger_trip_deletion_tracking` ูุชู ุชูุนููู ุชููุงุฆูุงู
   - ูุชู ุชุณุฌูู ุงูุญุฐู ูู `trip_deletions`
   - ูุชู ุญุณุงุจ ุนุฏุฏ ุงูุญุฐู ูู ุขุฎุฑ 24 ุณุงุนุฉ

3. **ุจุนุฏ ุงูุญุฐู**:
   - ุฅุฐุง ูุตู ุนุฏุฏ ุงูุญุฐู ุฅูู 3 ุฃู ุฃูุซุฑ:
     - ูุชู ุฅููุงู ุญุณุงุจ ุงูุณุงุฆู ุชููุงุฆูุงู (`account_suspended = TRUE`)
     - ูุชู ุฅุถุงูุฉ ุณุฌู ูู `account_suspensions`
     - ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ููุณุงุฆู
     - ูุชู ุฅุธูุงุฑ ุฑุณุงูุฉ ุฎุทุฃ ููุณุงุฆู: "ุชู ุฅููุงู ุญุณุงุจู ุจุณุจุจ ุญุฐู 3 ุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉ. ูุฑุฌู ุงูุชูุงุตู ูุน ุงููุฏูุฑ ูุฅุนุงุฏุฉ ุงูุชูุนูู."
   - ุฅุฐุง ูู ูุตู ุฅูู 3:
     - ูุชู ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ ูุน ุนุฏุฏ ุงูุญุฐู ุงููุชุจูู

---

## ๐ ุฃูุซูุฉ ุณููุงุฑูููุงุช

### ุงูุณููุงุฑูู 1: ุญุฐู ุฃูู ุฑุญูุฉ
- **ูุจู ุงูุญุฐู**: ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ ุนุงูุฉ
- **ุจุนุฏ ุงูุญุฐู**: ุฑุณุงูุฉ ูุฌุงุญ "ูุฏูู 2 ุญุฐู ูุชุจูู ูุจู ุฅููุงู ุญุณุงุจู"
- **ุงููุชูุฌุฉ**: ุงูุญุณุงุจ ูุง ูุฒุงู ูุดุทุงู

### ุงูุณููุงุฑูู 2: ุญุฐู ุซุงูู ุฑุญูุฉ (ูู ููุณ ุงูููู)
- **ูุจู ุงูุญุฐู**: "ูุฏูู 1 ุญุฐู ูู ุขุฎุฑ 24 ุณุงุนุฉ. ุจุงูู 1 ุญุฐู ูุจู ุฅููุงู ุญุณุงุจู."
- **ุจุนุฏ ุงูุญุฐู**: ุฑุณุงูุฉ ูุฌุงุญ "ูุฏูู 1 ุญุฐู ูุชุจูู ูุจู ุฅููุงู ุญุณุงุจู"
- **ุงููุชูุฌุฉ**: ุงูุญุณุงุจ ูุง ูุฒุงู ูุดุทุงู

### ุงูุณููุงุฑูู 3: ุญุฐู ุซุงูุซ ุฑุญูุฉ (ูู ููุณ ุงูููู)
- **ูุจู ุงูุญุฐู**: "โ๏ธ ุชุญุฐูุฑ: ูุฐู ูู ุงูุฑุญูุฉ ุงูุซุงูุซุฉ ุงูุชู ุชุญุฐููุง ูู ุขุฎุฑ 24 ุณุงุนุฉ. ุณูุชู ุฅููุงู ุญุณุงุจู ุชููุงุฆูุงู ุจุนุฏ ูุฐุง ุงูุญุฐู."
- **ุจุนุฏ ุงูุญุฐู**: ุฑุณุงูุฉ ุฎุทุฃ "ุชู ุฅููุงู ุญุณุงุจู ุจุณุจุจ ุญุฐู 3 ุฑุญูุงุช ูู ุขุฎุฑ 24 ุณุงุนุฉ. ูุฑุฌู ุงูุชูุงุตู ูุน ุงููุฏูุฑ ูุฅุนุงุฏุฉ ุงูุชูุนูู."
- **ุงููุชูุฌุฉ**: ุงูุญุณุงุจ ุชู ุฅููุงูู ุชููุงุฆูุงู

---

## ๐ ุฅุนุงุฏุฉ ุชูุนูู ุงูุญุณุงุจ

ูุฅุนุงุฏุฉ ุชูุนูู ุญุณุงุจ ุงูุณุงุฆูุ ูุฌุจ ุนูู ุงููุฏูุฑ:
1. ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ
2. ุงูุจุญุซ ุนู ุงูุณุงุฆู ุงูููููู
3. ุฅุนุงุฏุฉ ุชูุนูู ุงูุญุณุงุจ ูู ุฎูุงู ุชุญุฏูุซ `account_suspended = FALSE`

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุญุฏ ุงูุฒููู**: ูุชู ุญุณุงุจ ุงูุญุฐู ูู ุขุฎุฑ 24 ุณุงุนุฉ ูู ููุช ุงูุญุฐู ุงูุญุงูู
2. **ุงูุชููุงุฆูุฉ**: ุงููุธุงู ูุนูู ุชููุงุฆูุงู ุฏูู ุชุฏุฎู ูู ุงููุฏูุฑ
3. **ุงูุฅุดุนุงุฑุงุช**: ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุงุฆู ุนูุฏ ุฅููุงู ุงูุญุณุงุจ
4. **ุงูุณุฌูุงุช**: ูุชู ุญูุธ ุฌููุน ุนูููุงุช ุงูุญุฐู ูู `trip_deletions` ูููุฑุงุฌุนุฉ

---

## ๐๏ธ ุงูุตูุงูุฉ

### ุนุฑุถ ุณุฌูุงุช ุงูุญุฐู:
```sql
SELECT 
  td.*,
  p.full_name as driver_name,
  p.email as driver_email
FROM trip_deletions td
JOIN profiles p ON p.id = td.driver_id
ORDER BY td.deleted_at DESC;
```

### ุนุฑุถ ุงูุณุงุฆููู ุงูููููููู ุจุณุจุจ ุญุฐู ุงูุฑุญูุงุช:
```sql
SELECT 
  p.*,
  COUNT(td.id) as deletion_count,
  MAX(td.deleted_at) as last_deletion
FROM profiles p
JOIN trip_deletions td ON td.driver_id = p.id
WHERE p.account_suspended = TRUE
  AND td.deleted_at >= NOW() - INTERVAL '24 hours'
GROUP BY p.id
HAVING COUNT(td.id) >= 3;
```

---

## โ ุงูุงุฎุชุจุงุฑ

ูุงุฎุชุจุงุฑ ุงููุธุงู:
1. ูู ุจุฅูุดุงุก ุญุณุงุจ ุณุงุฆู ุชุฌุฑูุจู
2. ุฃูุดุฆ 3 ุฑุญูุงุช
3. ุงุญุฐู ุงูุฑุญูุฉ ุงูุฃููู โ ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ
4. ุงุญุฐู ุงูุฑุญูุฉ ุงูุซุงููุฉ โ ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ ุฃููู
5. ุงุญุฐู ุงูุฑุญูุฉ ุงูุซุงูุซุฉ โ ูุฌุจ ุฃู ูุชู ุฅููุงู ุงูุญุณุงุจ ุชููุงุฆูุงู

